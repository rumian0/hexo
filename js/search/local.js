window.addEventListener("load",function(){function e(){utils.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",openSearch),GLOBAL_CONFIG.right_menu&&document.getElementById("menu-search").addEventListener("click",function(){rm.hideRightMenu(),openSearch();var e=document.getElementsByClassName("search-box-input")[0],t=document.createEvent("HTMLEvents");t.initEvent("input",!0,!0),e.value=selectTextNow,e.dispatchEvent(t)})}var t,l=[],n=document.getElementById("search-mask"),c=document.querySelector("#local-search .search-dialog"),a=(window.openSearch=function(){utils.animateIn(n,"to_show 0.5s"),c.style.display="flex",setTimeout(function(){document.querySelector("#local-search .search-box-input").focus()},100),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(r(),document.removeEventListener("keydown",e))}),a(),window.addEventListener("resize",a)},function(){window.innerWidth<768&&c.style.setProperty("--search-height",window.innerHeight+"px")}),r=function(){utils.animateOut(c,"search_close .5s"),utils.animateOut(n,"to_hide 0.5s"),window.removeEventListener("resize",a)};0<(t=document.querySelectorAll("#local-search .tag-list")).length&&t.forEach(function(e){return e.addEventListener("click",function(e){return r()})}),document.addEventListener("keydown",function(e){e.ctrlKey&&"k"===e.key&&(e.preventDefault(),openSearch())}),n.addEventListener("click",r),utils.addEventListenerPjax(document.querySelector("#local-search .search-close-button"),"click",r);e();var d="",u=0,m=10,h=[];function i(){var s=document.getElementById("search-results");document.getElementById("search-input").addEventListener("input",function(e){if((s.innerHTML="")!==(d=this.value.trim())){o=new RegExp(d.split("").join(".*"),"i"),p(h=l.filter(function(e){return o.test(e.title)||o.test(e.content)}),u);for(var t=h.length,n=Math.ceil(t/m),c=((t=document.getElementById("search-pagination")).innerHTML="",document.createElement("ul")),a=(c.className="pagination-list",0);a<n;a++)(e=>{var t=document.createElement("li");t.className="pagination-item",t.textContent=e+1,e===u&&t.classList.add("select"),t.addEventListener("click",function(){p(h,u=e),document.querySelectorAll(".pagination-item").forEach(function(e){e.classList.remove("select")}),t.classList.add("select")}),c.appendChild(t)})(a);t.appendChild(c)}else t=document.getElementById("search-results"),r=document.getElementById("search-pagination"),i=document.getElementById("search-tips"),t.innerHTML="",r.innerHTML="",i.innerHTML="";var r,i,o})}function p(e,t){var c=document.getElementById("search-results"),n=(c.innerHTML="",document.getElementById("search-tips")),t=(n.innerHTML="",t*m);e.length?(e.slice(t,t+m).forEach(function(e){var t=document.createElement("li"),n=(t.className="search-result-item",document.createElement("a"));n.className="search-result-title",n.href=e.link,n.innerHTML=((e,t)=>(t=new RegExp("(".concat(t.split(" ").join("|"),")"),"gi"),e.replace(t,"<em>$1</em>")))(e.title,d),t.appendChild(n),c.appendChild(t)}),(t=document.createElement("span")).className="search-result-count",t.innerHTML=GLOBAL_CONFIG.lang.search.count.replace(/\$\{count}/,e.length),n.appendChild(t)):((e=document.createElement("span")).className="search-result-empty",e.textContent=GLOBAL_CONFIG.lang.search.empty.replace(/\$\{query}/,d),c.appendChild(e))}fetch(GLOBAL_CONFIG.localsearch.path).then(function(e){return e.text()}).then(function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("entry"),n=0;n<t.length;n++){var c=t[n],a=c.getElementsByTagName("title")[0].textContent,r=c.getElementsByTagName("url")[0].textContent,c=c.getElementsByTagName("content")[0].textContent;l.push({title:a,link:r,content:c})}}).catch(function(e){return console.error("Error loading search data:",e)}),i(),window.addEventListener("DOMContentLoaded",function(e){i()}),window.addEventListener("pjax:complete",function(){e()})});